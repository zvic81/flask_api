name: Create Pull Request
on:
  push:
    branches:
      - orders
jobs:

  createPullRequest:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Setup python
        uses: actions/setup-python@v1
        with:
          python-version: 3.8
      - name: Install depends
        run: pip install autopep8

      - name: Show files
        run: ls ${{ github.workspace }}/app

      - name: Run linters
        id: run_linters
        uses: wearerequired/lint-action@v2
        with:
          autopep8: true
          autopep8_dir: app/

      - name: make variables
        id: make_var
        run: |
          branch=$(git branch --show-current)
          echo branch=$branch >> $GITHUB_OUTPUT
          commits=$(git log --oneline)
          echo commits=$commits >> $GITHUB_OUTPUT
          echo "result of linter ${{ steps.run_linterss.outcome }}"

      - name: Create Pull Request
        id: cpr
        uses: peter-evans/create-pull-request@v4
        with:
          commit-message: Update ${{ steps.make_var.outputs.branch }}
          committer: zvic81 <zvic@list.ru>
          author: ${{ github.actor }} <${{ github.actor }}@zvic81.github.com>
          signoff: false
          branch: orders
          base: master
          title: '[Example] Update ${{ steps.make_var.outputs.branch }}'
          body: |
            Pull request for branch ${{ steps.make_var.outputs.branch }}
            Result of linter Pep8 : ${{ steps.run_linterss.outcome }}"
            This is all commits in branch:
            - ${{ steps.make_var.outputs.commits }}
            - Auto-generated by [create-pull-request][1]

            [1]: https://github.com/peter-evans/create-pull-request
          labels: |
            report
            automated pr
          assignees: zvic81
          reviewers: zvic81


      # - uses: actions/checkout@v3
      # - name: Create report file
      #   id: reports
      #   run: |
      #     echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
      #     echo "##[set-output name=commits;]::$(git log --oneline)"




        # with:
        #   token: ${{ secrets.GITHUB_TOKEN }}
        #   commit-message: Pull request to master
        #   committer: Zvic <zvic@list.ru>
        #   author: ${{ github.actor }} <${{ github.actor }}@users.noreply.github.com>
        #   body: |
        #     Auto-generated by [create-pull-request][1]
        #     - text fot test
        #     # All changes in branch ${{ steps.reports.outputs.branch }}
        #     # - ${{ steps.reports.outputs.commits }}

        #     [1]: https://github.com/peter-evans/create-pull-request
        #   title: '[From zvic] Pull request to master'
        #   labels: report, automated pr
        #   assignees: zvic81
        #   reviewers: css-ilgol
        #   branch: orders
        #   base: master




# name : 'test_on_push'
# on:
#   push:
#     branches:
#       - orders
# jobs:
#   run-linters:
#     name: Run linters
#     runs-on: ubuntu-latest

#     steps:
#       - name: check out repo
#         uses: actions/checkout@v2

#       - name: Setup python
#         uses: actions/setup-python@v1
#         with:
#           python-version: 3.8
#       - name: Install depends
#         run: pip install autopep8

#       - name: Show files
#         run: ls ${{ github.workspace }}/app

#       - name: Run linters
#         id: step-one
#         uses: wearerequired/lint-action@v2
#         with:
#           autopep8: true
#           autopep8_dir: app/
#   test:
#     name: testik
#     runs-on: ubuntu-latest
#     needs: run-linters
#     steps:
#       - name: Print
#         run:  echo "result of linter ${{ needs.run-linters.result }}"
